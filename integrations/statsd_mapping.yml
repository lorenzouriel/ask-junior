# StatsD Exporter mapping configuration for Airflow metrics
# This file maps Airflow StatsD metrics to Prometheus format

mappings:
  # DAG metrics
  - match: "airflow.dagrun.*.*.duration"
    name: "airflow_dagrun_duration"
    labels:
      dag_id: "$1"
      run_type: "$2"

  - match: "airflow.dagrun.*.*.success"
    name: "airflow_dagrun_success"
    labels:
      dag_id: "$1"
      run_type: "$2"

  - match: "airflow.dagrun.*.*.failed"
    name: "airflow_dagrun_failed"
    labels:
      dag_id: "$1"
      run_type: "$2"

  # Task metrics
  - match: "airflow.task.*.*.*.duration"
    name: "airflow_task_duration"
    labels:
      dag_id: "$1"
      task_id: "$2"
      run_type: "$3"

  - match: "airflow.task.*.*.*.success"
    name: "airflow_task_success"
    labels:
      dag_id: "$1"
      task_id: "$2"
      run_type: "$3"

  - match: "airflow.task.*.*.*.failed"
    name: "airflow_task_failed"
    labels:
      dag_id: "$1"
      task_id: "$2"
      run_type: "$3"

  # Scheduler metrics
  - match: "airflow.scheduler.*.*.scheduler_heartbeat"
    name: "airflow_scheduler_heartbeat"
    labels:
      hostname: "$1"
      job_id: "$2"

  - match: "airflow.scheduler.tasks.*.pending"
    name: "airflow_scheduler_tasks_pending"
    labels:
      pool: "$1"

  - match: "airflow.scheduler.tasks.running"
    name: "airflow_scheduler_tasks_running"

  - match: "airflow.scheduler.tasks.starving"
    name: "airflow_scheduler_tasks_starving"

  # Executor metrics
  - match: "airflow.executor.open_slots"
    name: "airflow_executor_open_slots"

  - match: "airflow.executor.queued_tasks"
    name: "airflow_executor_queued_tasks"

  - match: "airflow.executor.running_tasks"
    name: "airflow_executor_running_tasks"

  # Pool metrics
  - match: "airflow.pool.*.open_slots"
    name: "airflow_pool_open_slots"
    labels:
      pool_name: "$1"

  - match: "airflow.pool.*.running_slots"
    name: "airflow_pool_running_slots"
    labels:
      pool_name: "$1"

  - match: "airflow.pool.*.queued_slots"
    name: "airflow_pool_queued_slots"
    labels:
      pool_name: "$1"

  # Default catch-all for any other Airflow metrics
  - match: "airflow.*"
    name: "airflow_${1}"
    match_metric_type: counter
